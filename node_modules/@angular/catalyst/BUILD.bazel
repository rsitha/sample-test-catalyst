# Add rules here to build your software
# See https://docs.bazel.build/versions/main/build-ref.html#BUILD_files

load("@npm//@bazel/typescript:index.bzl", "ts_config")
load("//tools:typescript.bzl", "ts_project")
load("@build_bazel_rules_nodejs//:index.bzl", "js_library")
load("//tools:karma.bzl", "karma_web_test_suite")
load("//tools:angular_ts.bzl", "ng_ts_project")

package(default_visibility = ["//visibility:public"])

ts_config(
    name = "tsconfig",
    src = "tsconfig.json",
)

ts_project(
    name = "catalyst-ts",
    srcs = [
      "index.ts",
      "catalyst-harness-environment.ts",
      "helpers.ts",
      "public-api.ts",
      "matchers/helpers.ts",
      "matchers/async_matchers.ts"
    ],
    deps = [
      "@npm//angular",
      "@npm//@angular/core",
      "@npm//@angular/cdk",
      "@npm//@angular/platform-browser-dynamic",
      "@npm//@angular/upgrade",
      "@npm//@types/jasmine",
      "@npm//@types/angular",
      "@npm//@types/angular-mocks",
    ],
)

js_library(
    name = "catalyst",
    package_name = "@angular/catalyst",
    deps = [":catalyst-ts"],
)

ts_project(
    name = "async_matchers_test_lib",
    srcs = [
      "matchers/async_matchers_test.ts",
    ],
    deps = [
      ":catalyst",
    ],
)

karma_web_test_suite(
    name = "async_matchers_test",
    browsers = [
        "@io_bazel_rules_webtesting//browsers:chromium-local",
    ],
    specs = [
        ":async_matchers_test_lib",
    ],
    deps = [
        ":async_matchers_test_lib",
    ],
)

ng_ts_project(
    name = "test_component",
    srcs = [
      "test_component.ts",
    ],
    angular_assets = ["test_component.ng.html"],
    deps = [
      "@npm//@angular/core",
      "@npm//@angular/material",
    ],
)

ng_ts_project(
    name = "integration_test_lib",
    srcs = [
      "integration_test.ts",
    ],
    deps = [
        ":test_component",
        ":catalyst",
    ],
)

karma_web_test_suite(
    name = "integration_test",
    browsers = [
        "@io_bazel_rules_webtesting//browsers:chromium-local",
    ],
    specs = [
        ":integration_test_lib",
    ],
    deps = [
        ":integration_test_lib",
    ],
)
