# shared-angular-catalyst
Opinionated wrapper around the Angular testing API with the aim of reducing number of decisions and boilerplate while writing tests.

## Use Catalyst in a Bazel Project

1. Set up Catalyst dependency in your Bazel WORKSPACE, e.g.

```
load("@bazel_tools//tools/build_defs/repo:git.bzl", "git_repository")

# Catalyst library
git_repository(
    name = "catalyst",
    remote = "https://github.com/verily-src/shared-angular-catalyst.git",
    commit = "45626943c4a1cab99967e56172a75717f0a10d77",
)
```

2. Import Catalyst in your Angular test, e.g.

```
import {beforeEach, bootstrap, describe, flush, get, getEl, it, setupModule} from '@angular/catalyst';
```

3. Add Bazel dependency to build your test, e.g.

```
ts_project(
    name = "my_lib_test",
    srcs = [
        "my_lib_test.ts",
    ],
    deps = [
        ":my_lib",
        "@catalyst",
        "@npm//@angular/core",
    ],
)
```


## Use Catalyst with NPM
1. Add Catalyst NPM dependency

```
npm install https://github.com/verily-src/shared-angular-catalyst.git
```

2. Import Catalyst in your Angular test, e.g.

```
import {beforeEach, bootstrap, describe, flush, get, getEl, it, setupModule} from '@angular/catalyst';
```

## Troubleshooting
If `npm install` reports ERROR code ERESOLVE while resolving `jasmine-core`, consider install with
`--legacy-peer-deps`. See [.npmrc](https://github.com/verily-src/shared-angular-catalyst/blob/master/.npmrc)
as an example. This repo is intended to be out-of-synced with G3 Catalyst, the jasmine dependency version is
intended not to be updated. Read #Caveats for more details.


## Caveats
Catalyst uses a fakeAsync Zone to capture all async tasks within Angular and resolve them synchronously, which
is not compatible with ES2017+. The Angular team may deliver an update to the google3 implementation that is
compatible with ES2017+ but likely with breaking changes. We do not intend to keep this repo in sync with this
yet understood future change. This isn't a blocker for Verily off-g3 migration effort, but for a longer-term
direction of ES2017+ compliance, please consider migrate off of Catalyst to use Angular OSS offerings (e.g. TestBed).
Or if in the future, Angular Tooling team chooses to release a new public version of Catalyst to GitHub, it
could be leveraged.
